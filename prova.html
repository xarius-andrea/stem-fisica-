<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Simulatore di Portanza Aerea</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, #f4faff, #bad5e2);
      color: #222;
      text-align: center;
    }

    h1 {
      margin-top: 30px;
      font-size: 2em;
      color: #004080;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }

    .controls {
      margin-top: 20px;
      background: #ffffffcc;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    input[type=number], input[type=range] {
      margin: 10px;
    }

    input[type=range] {
      width: 200px;
      accent-color: #007bff;
      cursor: pointer;
    }

    button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }

    button:hover {
      background: #0056b3;
    }

    #output {
      margin-top: 20px;
      padding: 15px;
      background: #eaf4ff;
      border-radius: 10px;
      font-family: monospace;
      text-align: left;
      display: inline-block;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    .output-header {
      font-size: 1.2em;
      color: #004080;
      margin-bottom: 10px;
    }

    .output-item {
      margin: 8px 0;
      font-size: 1em;
    }

    .canvases {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 30px;
    }

    canvas {
      border: 2px solid #444;
      border-radius: 10px;
      background: #cce6ff;
    }

    #note {
      font-size: 0.9em;
      color: #535353;
      margin-top: 20px;
    }

    .error {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }

    @media (max-width: 768px) {
      .canvases {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simulatore di Portanza Aerea</h1>
    <p>Inserisci la velocità e la curvatura dell'ala. Il sistema simula se l’aereo può decollare.</p>

    <div class="controls">
      <label>Velocità volo (in km/h):</label>
      <input type="number" id="velocita" value="250" min="100" max="7000">
      <span id="velocitaNodi">(~378 kt)</span><br>

      <label>Curvatura ala (m):</label>
      <input type="range" id="profilo" min="0.1" max="1.0" step="0.01" value="0.7" oninput="aggiornaValore()">
      <span id="valoreCurvatura">0.3</span> m<br>

      <label>Inclinazione ala (in gradi):</label>
      <input type="range" id="inclinazione" min="0" max="20" step="0.1" value="12.5" oninput="aggiornaInclinazione()"> 
      <span id="valoreInclinazione">12.5</span>°<br>

      <button onclick="calcola()">Calcola e Simula</button>
    </div>

        <div class="canvases">
        <div style="display: flex; flex-direction: column; align-items: center;">
            <canvas id="alaCanvas" width="450" height="300"></canvas>
            <canvas id="canvasDati" width="450" height="180"></canvas>
        </div>
        <div style="display: flex; flex-direction: column; align-items: center;">
            <canvas id="voloCanvas" width="450" height="300"></canvas>
            <canvas id="canvasTempo" width="450" height="80"></canvas>
        </div>
        </div>

    <!-- Nuovi canvas per dati e tempo -->
    <canvas id="canvasDati" width="450" height="150"></canvas><br>
    <canvas id="canvasTempo" width="450" height="60"></canvas><br>

    <!-- Output nascosto -->
    <div id="output" style="display:none;"></div>

    <div id="note">
      <em>Nota: Una maggiore curvatura dell’ala aumenta la portanza. </em>
    </div>
  </div>

  <script>
    const alaCanvas = document.getElementById("alaCanvas");
    const ctx = alaCanvas.getContext("2d");
    const voloCanvas = document.getElementById("voloCanvas");
    const vctx = voloCanvas.getContext("2d");

    let decollo = false;
    let y = 100;
    let x = 100;
    let animazioneInCorso = false;

    function aggiornaValore() {
      const b = parseFloat(document.getElementById("profilo").value);
      document.getElementById("valoreCurvatura").innerText = b.toFixed(2);
    }

    function aggiornaInclinazione() {
      const inclinazione = parseFloat(document.getElementById("inclinazione").value);
      document.getElementById("valoreInclinazione").innerText = inclinazione.toFixed(1);
    }

    function calcolaCL(inclinazioneGradi) {
      const alpha = inclinazioneGradi * Math.PI / 180;
      const alphaMax = 12.5 * Math.PI / 180;
      const k = 31.58;
      const CK = -k * Math.pow(alpha - alphaMax, 2);
      const CL = CK + 1.5;
      return Math.max(CL, 0);
    
    }

    function calcola() {
      let v_kmh = parseFloat(document.getElementById("velocita").value);
      const b = parseFloat(document.getElementById("profilo").value);
      const inclinazione = parseFloat(document.getElementById("inclinazione").value);

      const v = v_kmh / 3.6;
      const nodi = v_kmh / 1.852;
      document.getElementById("velocitaNodi").innerText = `≈ ${nodi.toFixed(1)} nodi`;

      const a = 1.5;
      const L1 = 5;
      const L2 = 15;
      const rho = 1.225;
      const massa = 37000;
      const peso = massa * 9.81;

      const area1 = a * L1 * (Math.PI * b + 1);
      const OH = Math.sqrt((a ** 2) / 16 + (a ** 4) / (64 * b ** 2));
      const k = Math.sqrt(L2 ** 2 + OH ** 2);
      const c = Math.sqrt((a / 2) ** 2 + b ** 2);
      const areaVCB = c * k;

      const OJ = Math.abs((b ** 2 - (a ** 2) / 4) / (2 * b));
      const u = Math.sqrt(L2 ** 2 + OJ ** 2);
      const areaVAB = (a * u) / 2;
      const area2 = areaVAB + areaVCB;

      const area_ala = area1 + area2;
      const CL = calcolaCL(inclinazione);

      const portanza = 0.5 * rho * v ** 2 * area_ala * 2 * CL;

      decollo = portanza > peso;

      let tempo = "-";
      if (decollo) {
        let ay = (portanza - peso) / massa;
        const h = 2;
        tempo = Math.sqrt((2 * h) / ay).toFixed(2) + " s";
      }

      disegnaDatiAerodinamici(v, area_ala, CL, b, portanza, peso);
      disegnaTempoSollevamento(tempo);

      disegnaAla(b, inclinazione);
      avviaAnimazione();

      disegnaDatiAerodinamici(v, area_ala, CL, b, portanza, peso);
      disegnaTempoSollevamento(tempo);
    }

    function disegnaAla(b, inclinazione) {
      ctx.clearRect(0, 0, alaCanvas.width, alaCanvas.height);
      const baseY = 150;
      const scala = 100;
      const inclinazioneRad = inclinazione * Math.PI / 180;

      ctx.save();
      ctx.translate(alaCanvas.width / 2, alaCanvas.height / 2);
      ctx.rotate(-inclinazioneRad);
      ctx.translate(-alaCanvas.width / 2, -alaCanvas.height / 2);
ctx.beginPath();
      ctx.moveTo(50, baseY);
      ctx.bezierCurveTo(150, baseY - b * scala, 300, baseY - b * scala, 400, baseY);
 ctx.lineTo(400, baseY + 10);
      ctx.bezierCurveTo(300, baseY + 10 + b * scala, 150, baseY + 10 + b * scala, 50, baseY + 10);
      ctx.closePath();
      ctx.fillStyle = "#0056b3";
      ctx.fill();

      ctx.restore();
    }

    function avviaAnimazione() {
      if (animazioneInCorso) return;
      animazioneInCorso = true;
      x = 50;
      y = 200;
      vctx.clearRect(0, 0, voloCanvas.width, voloCanvas.height);
      animazione();
    }

    function animazione() {
      vctx.clearRect(0, 0, voloCanvas.width, voloCanvas.height);
      vctx.beginPath();
      vctx.arc(x, y, 15, 0, 2 * Math.PI);
      vctx.fillStyle = decollo ? "green" : "gray";
      vctx.fill();

      x += 2;
      if (decollo && y > 100) y -= 1.5;

      if (x < voloCanvas.width) {
        requestAnimationFrame(animazione);
      } else {
        animazioneInCorso = false;
      }
    }

    function disegnaDatiAerodinamici(v, area, CL, b, portanza, peso) {
      const canvas = document.getElementById("canvasDati");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = "14px Roboto";
      ctx.fillStyle = "#003366";

      const dati = [
        `Velocità: ${v.toFixed(2)} m/s`,
        `Area alare: ${area.toFixed(2)} m²`,
        `Curvatura ala: ${b.toFixed(2)} m`,
        `CL (coeff. portanza): ${CL.toFixed(3)}`,
        `Portanza: ${portanza.toFixed(2)} N`,
        `Peso: ${peso.toFixed(2)} N`,
        `Decollo: ${portanza > peso ? "SÌ ✈️" : "NO ❌"}`
      ];

      for (let i = 0; i < dati.length; i++) {
        ctx.fillText(dati[i], 10, 25 + i * 20);
      }
    }

    function disegnaTempoSollevamento(tempo) {
      const canvas = document.getElementById("canvasTempo");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.font = "18px Roboto";
      ctx.fillStyle = "#222";
      ctx.fillText(`Tempo stimato per il decollo: ${tempo}`, 10, 40);
    }

    // Inizializzazione valori iniziali visuali
    aggiornaValore();
    aggiornaInclinazione();
  </script>
</body>
</html>
